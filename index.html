<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nutrition Finder | ค้นหาคุณค่าโภชนาการ</title>
  <meta name="description" content="ค้นหาโภชนาการจาก OpenFoodFacts บน GitHub Pages (Static Web App)" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1220;--card:#121a2b;--muted:#7e8ba3;--text:#e7ecf5;--accent:#74c0fc;--good:#2ecc71;--warn:#f59f00}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0b1220 0%,#0e1628 100%);color:var(--text)}
    header{max-width:1000px;margin:40px auto 16px;padding:0 20px}
    h1{font-size:clamp(24px,3.5vw,40px);margin:0 0 8px;line-height:1.15}
    p.sub{margin:0;color:var(--muted)}
    .searchbar{max-width:1000px;margin:18px auto 8px;padding:0 20px;display:grid;grid-template-columns:1fr auto;gap:10px}
    input[type="search"]{width:100%;padding:14px 16px;border-radius:14px;border:1px solid #23304d;background:#0f1729;color:var(--text);outline:none}
    button{border:0;background:var(--accent);color:#06131f;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    .options{max-width:1000px;margin:0 auto;padding:0 20px;color:var(--muted);display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    .results{max-width:1000px;margin:18px auto 60px;padding:0 20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid #1e2a44;border-radius:18px;overflow:hidden;display:flex;flex-direction:column}
    .card .imgwrap{background:#0f1729;height:170px;display:flex;align-items:center;justify-content:center}
    .card img{max-height:100%;max-width:100%;object-fit:contain}
    .card .body{padding:14px 14px 8px}
    .name{font-weight:700;margin:0 0 6px;font-size:16px}
    .brand{color:var(--muted);font-size:13px;margin-bottom:10px}
    .nutri{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px}
    .chip{background:#0f1729;border:1px solid #223154;border-radius:10px;padding:8px;font-size:13px;display:flex;justify-content:space-between;gap:8px}
    .muted{color:var(--muted)}
    .footer{max-width:1000px;margin:0 auto 40px;padding:0 20px;color:var(--muted);font-size:13px}
    .loader{display:none;place-items:center;margin:24px auto;color:var(--muted)}
    .empty{color:var(--muted);text-align:center;margin:26px 0}
    .badge{display:inline-block;background:#13223a;border:1px solid #26436b;color:#a6c8ff;padding:4px 8px;border-radius:999px;font-size:12px;margin-left:8px}
    .sr{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
    .pill{background:#0f1a2e;border:1px solid #263453;color:#c8d7ff;border-radius:999px;padding:6px 10px;font-size:12px}
    a{color:#a6c8ff}
  </style>
</head>
<body>
  <header>
    <h1>Nutrition Finder <span class="badge">GitHub Pages</span></h1>
    <p class="sub">เว็บไซต์ค้นหา <strong>คุณค่าโภชนาการ</strong> จากฐานข้อมูลสาธารณะ <a href="https://world.openfoodfacts.org/" target="_blank" rel="noopener">OpenFoodFacts</a> แบบเรียลไทม์ · ไม่มีเซิร์ฟเวอร์ · เหมาะกับงานสอน/สืบค้น</p>
  </header>

  <form class="searchbar" id="searchForm">
    <label class="sr" for="q">คำค้นหา</label>
    <input id="q" type="search" placeholder="พิมพ์ชื่ออาหาร/ผลิตภัณฑ์ เช่น yogurt, rice, chocolate…" autocomplete="off" />
    <button id="btnSearch" type="submit">ค้นหา</button>
  </form>

  <div class="options">
    <span class="pill" title="จำนวนผลลัพธ์ต่อหน้า">ผล/หน้า
      <select id="pageSize" style="background:transparent;border:0;color:inherit">
        <option>10</option>
        <option selected>20</option>
        <option>50</option>
      </select>
    </span>
    <span class="pill">ภาษาแสดงผล: ไทย/อังกฤษ</span>
    <span class="pill">หน่วยต่อ 100 g (จากฉลาก)</span>
  </div>

  <div class="loader" id="loader">กำลังค้นหา…</div>
  <div class="empty" id="empty"></div>
  <section class="results" id="results" aria-live="polite"></section>

  <div class="footer">
    แหล่งข้อมูล: OpenFoodFacts (สาธารณะ). ค่าที่แสดงเป็น <em>per 100 g</em> ตามฉลากของผู้ผลิต อาจมีบางรายการไม่ครบทุกสารอาหาร.
  </div>

<script>
// ===== Config =====
const API_SEARCH = 'https://world.openfoodfacts.org/cgi/search.pl';
const IMG_FALLBACK = 'https://static.openfoodfacts.org/images/icons/dist/product-add.svg';

// ===== Helpers =====
const $ = (sel)=>document.querySelector(sel);
function fmt(num, digits=1){
  if(num===undefined || num===null || Number.isNaN(num)) return '–';
  return Number(num).toFixed(digits);
}
function makeChip(label, value, unit=''){
  return `<div class="chip"><span>${label}</span><strong>${value} ${unit}</strong></div>`;
}

// ===== Render Card =====
function renderCard(p){
  const n = p.product_name || p.generic_name || '(ไม่มีชื่อผลิตภัณฑ์)';
  const brand = p.brands || '—';
  const img = p.image_front_small_url || p.image_url || IMG_FALLBACK;
  const N = p.nutriments || {};
  const energy = N['energy-kcal_100g'] ?? (N['energy_100g']? N['energy_100g']/4.184 : undefined); // fallback kcal
  const protein = N['proteins_100g'];
  const fat = N['fat_100g'];
  const carbs = N['carbohydrates_100g'];
  const sugars = N['sugars_100g'];
  const fiber = N['fiber_100g'];
  const sodium = N['sodium_100g'];
  const salt = N['salt_100g'];

  return `
  <article class="card">
    <div class="imgwrap"><img alt="${n}" loading="lazy" src="${img}"></div>
    <div class="body">
      <h3 class="name">${n}</h3>
      <div class="brand">ยี่ห้อ/ผู้ผลิต: ${brand}</div>
      <div class="nutri">
        ${makeChip('พลังงาน', fmt(energy), 'kcal')}
        ${makeChip('โปรตีน', fmt(protein), 'g')}
        ${makeChip('ไขมัน', fmt(fat), 'g')}
        ${makeChip('คาร์บฯ', fmt(carbs), 'g')}
        ${makeChip('น้ำตาล', fmt(sugars), 'g')}
        ${makeChip('ใยอาหาร', fmt(fiber), 'g')}
        ${makeChip('โซเดียม', sodium!=null?fmt(sodium*1000):'–', 'mg')}
        ${makeChip('เกลือ', fmt(salt), 'g')}
      </div>
      <div class="muted" style="margin-top:10px">
        รหัสบาร์โค้ด: ${p.code || '—'} · ประเทศ: ${p.countries || '—'}
      </div>
    </div>
  </article>`;
}

// ===== Search =====
async function searchFoods(q, pageSize=20){
  const url = new URL(API_SEARCH);
  url.searchParams.set('search_terms', q);
  url.searchParams.set('search_simple', '1');
  url.searchParams.set('action', 'process');
  url.searchParams.set('json', '1');
  url.searchParams.set('page_size', String(pageSize));

  $('#loader').style.display='grid';
  $('#empty').textContent='';
  $('#results').innerHTML='';

  try{
    const res = await fetch(url.toString());
    if(!res.ok) throw new Error('Network error');
    const data = await res.json();
    const products = (data.products||[]).filter(p=>p.nutriments);

    if(products.length===0){
      $('#empty').textContent='ไม่พบข้อมูล ลองใช้คำค้นอื่น (เช่น ภาษาอังกฤษ/ทั่วไป)';
      return;
    }
    const html = products.map(renderCard).join('');
    $('#results').innerHTML = html;
  }catch(err){
    console.error(err);
    $('#empty').textContent='เกิดข้อผิดพลาดในการดึงข้อมูล กรุณาลองใหม่อีกครั้ง';
  }finally{
    $('#loader').style.display='none';
  }
}

// ===== Events =====
const form = $('#searchForm');
form.addEventListener('submit', (e)=>{
  e.preventDefault();
  const q = $('#q').value.trim();
  if(!q){
    $('#empty').textContent='โปรดพิมพ์คำค้นหา';
    return;
  }
  const pageSize = Number($('#pageSize').value || 20);
  searchFoods(q, pageSize);
});

// Enter to search immediately on first load focus
window.addEventListener('DOMContentLoaded',()=>{
  $('#q').focus();
});
</script>
</body>
</html>
