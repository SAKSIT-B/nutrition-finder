<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nutrition Finder | ค้นหาคุณค่าโภชนาการ</title>
  <meta name="description" content="ค้นหา/สำรวจข้อมูลโภชนาการแบบฉับไว เหมาะกับงานสอนและสืบค้น บน GitHub Pages" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{ --radius:16px; --shadow:0 5px 18px rgba(15,23,42,.06); }
    :root,[data-theme="light"]{
      --bg:#f7fafc; --text:#0f172a; --muted:#5b677a; --card:#fff; --border:#e5e9f2;
      --accent:#2563eb; --accent-weak:#e6efff; --chip:#f1f5f9; --chip-border:#e2e8f0; --link:#0b5ad9; --overlay:rgba(15,23,42,.45);
    }
    [data-theme="dark"]{
      --bg:#0b1220; --text:#e7ecf5; --muted:#8ea0bd; --card:#121a2b; --border:#1f2a44;
      --accent:#74c0fc; --accent-weak:#0c2d4f; --chip:#0f1729; --chip-border:#223154; --link:#a6c8ff; --overlay:rgba(0,0,0,.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:var(--link)}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.7);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
    [data-theme="dark"] .topbar{background:rgba(10,16,30,.6)}
    .topbar .wrap{display:flex;align-items:center;gap:12px;min-height:64px}
    .logo{display:inline-flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
    .logo .dot{width:12px;height:12px;border-radius:999px;background:var(--accent)}
    .title{font-weight:800;font-size:18px}
    .credit-top{margin-left:auto;font-size:13px;color:var(--muted)}
    .theme-btn,.menu-btn{border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}
    .menu-btn{margin-right:6px}

    /* Sidebar overlay (LEFT) */
    .overlay{position:fixed;inset:0;background:var(--overlay);opacity:0;pointer-events:none;transition:.25s;z-index:30}
    .sidebar{position:fixed;inset:0 auto 0 0;width:280px;max-width:80vw;background:var(--card);color:var(--text);border-right:1px solid var(--border);transform:translateX(-100%);transition:transform .25s;z-index:31;display:flex;flex-direction:column}
    .sidebar header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .sidebar nav{padding:10px 8px;display:flex;flex-direction:column;gap:6px}
    .navlink{padding:10px 12px;border-radius:12px;text-decoration:none;color:inherit;border:1px solid transparent}
    .navlink:hover{background:var(--chip);border-color:var(--chip-border)}
    .sidebar.show{transform:none}
    .overlay.show{opacity:1;pointer-events:auto}

    /* Logos */
    .brandstrip{display:flex;gap:16px;align-items:center;flex-wrap:wrap;margin:10px 0}
    .brandstrip img{height:36px;object-fit:contain}
    [data-theme="dark"] .brandstrip img{filter:brightness(1) contrast(1.05)}

    /* Hero & search */
    header.hero{padding:16px 0 10px}
    header.hero h1{font-size:clamp(24px,3.2vw,38px);margin:6px 0 8px}
    header.hero .sub{margin:0;color:var(--muted)}
    .searchbar{margin:18px 0 6px;display:grid;grid-template-columns:1fr auto;gap:10px}
    input[type="search"]{width:100%;padding:16px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card);color:var(--text);outline:none;box-shadow:var(--shadow)}
    input[type="search"]:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-weak)}
    button.primary{border:0;background:var(--accent);color:#fff;padding:14px 18px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    button.primary:hover{filter:brightness(.95)}

    .options{color:var(--muted);display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{background:var(--card);border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;box-shadow:var(--shadow)}

    /* Cards */
    .results{margin:18px 0 60px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--shadow)}
    .card .imgwrap{background:var(--chip);height:170px;display:flex;align-items:center;justify-content:center}
    .card img{max-height:100%;max-width:100%;object-fit:contain}
    .card .body{padding:14px}
    .name{font-weight:700;margin:0 0 6px;font-size:16px}
    .brand{color:var(--muted);font-size:13px;margin-bottom:10px}
    .nutri{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px}
    .chip{background:var(--chip);border:1px solid var(--chip-border);border-radius:12px;padding:10px 12px;font-size:13px;display:flex;justify-content:space-between;gap:8px}
    .muted{color:var(--muted)}
    .actions{display:flex;gap:8px;margin-top:12px}
    .btn{border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer;text-decoration:none}

    .loader{display:none;place-items:center;margin:24px auto;color:var(--muted)}
    .empty{color:var(--muted);text-align:center;margin:26px 0}

    footer{border-top:1px solid var(--border);padding:18px 0 40px;color:var(--muted);font-size:13px}
    .sr{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <!-- Overlay + Sidebar (LEFT) -->
  <div class="overlay" id="overlay"></div>
  <aside class="sidebar" id="sidebar">
    <header>
      <strong>เมนู</strong>
      <button class="theme-btn" id="closeSidebar">✕</button>
    </header>
    <nav>
      <a class="navlink" href="./">หน้าแรก</a>
      <a class="navlink" href="./calculator.html">เครื่องคิดโภชนาการ</a>
      <a class="navlink" href="#" onclick="alert('เวอร์ชันทดลองบน GitHub Pages');return false;">เกี่ยวกับ</a>
    </nav>
  </aside>

  <!-- Topbar -->
  <div class="topbar">
    <div class="container">
      <div class="wrap">
        <button class="menu-btn" id="openSidebar">☰</button>
        <a class="logo" href="#" aria-label="Home">
          <span class="dot"></span><span class="title">Nutrition Finder</span>
        </a>
        <div class="credit-top" id="creditTop"></div>
        <button class="theme-btn" id="themeToggle" title="สลับธีม">สลับธีม</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Logos -->
    <div class="brandstrip">
      <img id="logo1" alt="สถาบัน 1" src="" />
      <img id="logo2" alt="สถาบัน 2" src="" />
      <img id="logo3" alt="สถาบัน 3" src="" />
    </div>

    <!-- Hero -->
    <header class="hero" role="banner">
      <h1>ค้นหาคุณค่าโภชนาการ</h1>
      <p class="sub">สำรวจข้อมูลโภชนาการอย่างรวดเร็ว เหมาะกับงานสอน/สืบค้น · เว็บสแตติกบน GitHub Pages</p>

      <form class="searchbar" id="searchForm">
        <label class="sr" for="q">คำค้นหา</label>
        <input id="q" type="search" placeholder="พิมพ์ชื่ออาหาร/ผลิตภัณฑ์" autocomplete="off" />
        <button class="primary" id="btnSearch" type="submit">ค้นหา</button>
      </form>

      <div class="options">
        <span class="pill">ผล/หน้า
          <select id="pageSize" style="background:transparent;border:0;color:inherit">
            <option>10</option><option selected>20</option><option>50</option>
          </select>
        </span>
        <span class="pill">หน่วยต่อ 100 g (ตามฉลาก)</span>
      </div>

      <div class="loader" id="loader">กำลังค้นหา…</div>
      <div class="empty" id="empty"></div>

      <div class="row" style="margin-top:12px">
        <a class="btn" href="calculator.html">ไปหน้าเครื่องคิดโภชนาการด้วยตนเอง →</a>
      </div>
    </header>

    <!-- Results -->
    <section class="results" id="results" aria-live="polite"></section>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div>
        ข้อมูลโภชนาการที่ใช้ในหน้าเครื่องคิด มาจาก 
        <a href="https://thaifcd.anamai.moph.go.th/" target="_blank" rel="noopener">ThaiFCD (กรมอนามัย กระทรวงสาธารณสุข)</a>
        — จัดเก็บแบบสแตติกใน <code>data/ingredients.json</code> เพื่อใช้งานบน GitHub Pages
      </div>
      <div id="creditBottom" style="margin-top:6px"></div>
    </div>
  </footer>

<script>
/* ===== Settings (เครดิต + โลโก้ + ธีม + Sidebar) ===== */
const CREDIT_TEXT = "ผู้จัดทำ: ครูศักดิ์สิทธิ์ บำรุง | ข้อมูลอ้างอิง: ThaiFCD (กรมอนามัย กระทรวงสาธารณสุข) • จัดเก็บใน data/ingredients.json เพื่อใช้งานบน GitHub Pages";
const LOGOS = ["assets/img/logo1.png","assets/img/logo2.png","assets/img/logo3.png"];

const root=document.documentElement;
function applyTheme(t){ root.setAttribute('data-theme',t); localStorage.setItem('nf-theme',t); }
function toggleTheme(){ const cur=root.getAttribute('data-theme')||'light'; applyTheme(cur==='light'?'dark':'light'); }
(function initTheme(){ applyTheme(localStorage.getItem('nf-theme')||'light'); })();
document.getElementById('themeToggle').addEventListener('click',toggleTheme);

function safeSetLogo(id,src){ const el=document.getElementById(id); if(!el) return; el.onerror=()=>{el.style.display='none'}; if(src) el.src=src; }
function $(s){return document.querySelector(s)}

/* Sidebar overlay (LEFT) */
const sidebar=$('#sidebar'), overlay=$('#overlay');
$('#openSidebar').addEventListener('click',()=>{sidebar.classList.add('show');overlay.classList.add('show')});
$('#closeSidebar').addEventListener('click',()=>{sidebar.classList.remove('show');overlay.classList.remove('show')});
overlay.addEventListener('click',()=>{sidebar.classList.remove('show');overlay.classList.remove('show')});
document.addEventListener('keydown',e=>{ if(e.key==='Escape'){sidebar.classList.remove('show');overlay.classList.remove('show')}});

/* เครดิต + โลโก้ */
window.addEventListener('DOMContentLoaded',()=>{
  const t=$('#creditTop'), b=$('#creditBottom');
  if(t) t.textContent=CREDIT_TEXT;
  if(b) b.textContent=CREDIT_TEXT;
  const [l1,l2,l3]=LOGOS; safeSetLogo('logo1',l1); safeSetLogo('logo2',l2); safeSetLogo('logo3',l3);
  $('#q').focus();
});

/* ===== ค้นหา (ตัวอย่าง UI—ลบการอ้างลิงก์ภายนอกแล้ว) ===== */
const API_SEARCH='https://world.openfoodfacts.org/cgi/search.pl';
const IMG_FALLBACK='https://static.openfoodfacts.org/images/icons/dist/product-add.svg';
function fmt(n,d=1){ if(n==null||Number.isNaN(n)) return '–'; return Number(n).toFixed(d); }
function makeChip(label, value, unit=''){ return `<div class="chip"><span>${label}</span><strong>${value} ${unit}</strong></div>`; }

function renderCard(p){
  const n = p.product_name_th || p.generic_name_th || p.product_name || p.generic_name || '(ไม่มีชื่อผลิตภัณฑ์)';
  const brand = p.brands || '—';
  const img = p.image_front_small_url || p.image_url || IMG_FALLBACK;
  const N = p.nutriments || {};
  const energy = N['energy-kcal_100g'] ?? (N['energy_100g']? N['energy_100g']/4.184 : undefined);
  const protein = N['proteins_100g'], fat = N['fat_100g'], carbs = N['carbohydrates_100g'];
  const sugars = N['sugars_100g'], fiber = N['fiber_100g'];
  return `
  <article class="card">
    <div class="imgwrap"><img alt="${n}" loading="lazy" src="${img}"></div>
    <div class="body">
      <h3 class="name">${n}</h3>
      <div class="brand">ยี่ห้อ/ผู้ผลิต: ${brand}</div>
      <div class="nutri">
        ${makeChip('พลังงาน', fmt(energy), 'kcal')}
        ${makeChip('โปรตีน', fmt(protein), 'g')}
        ${makeChip('ไขมัน', fmt(fat), 'g')}
        ${makeChip('คาร์บฯ', fmt(carbs), 'g')}
        ${makeChip('น้ำตาล', fmt(sugars), 'g')}
        ${makeChip('ใยอาหาร', fmt(fiber), 'g')}
      </div>
    </div>
  </article>`;
}

async function searchFoods(q, pageSize=20){
  const url=new URL(API_SEARCH);
  url.searchParams.set('search_terms',q);
  url.searchParams.set('search_simple','1');
  url.searchParams.set('action','process');
  url.searchParams.set('json','1');
  url.searchParams.set('page_size',String(pageSize));
  url.searchParams.set('lc','th');

  $('#loader').style.display='grid'; $('#empty').textContent=''; $('#results').innerHTML='';
  try{
    const res=await fetch(url.toString()); if(!res.ok) throw new Error('Network');
    const data=await res.json(); const products=(data.products||[]).filter(p=>p.nutriments);
    if(products.length===0){ $('#empty').textContent='ไม่พบข้อมูล ลองคำอื่น ๆ'; return; }
    $('#results').innerHTML=products.map(renderCard).join('');
  }catch(e){ console.error(e); $('#empty').textContent='เกิดข้อผิดพลาด ลองใหม่อีกครั้ง'; }
  finally{ $('#loader').style.display='none'; }
}

$('#searchForm').addEventListener('submit',e=>{
  e.preventDefault();
  const q=$('#q').value.trim(); if(!q){ $('#empty').textContent='โปรดพิมพ์คำค้นหา'; return; }
  const pageSize=Number($('#pageSize').value||20); searchFoods(q,pageSize);
});
</script>
</body>
</html>
