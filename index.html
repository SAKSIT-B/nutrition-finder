<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nutrition Finder ‚Ä¢ Dashboard</title>
<meta name="description" content="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å OpenFoodFacts ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‚Ä¢ Static on GitHub Pages" />

<!-- Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#F6F8FC; --card:#FFFFFF; --text:#111827; --muted:#6B7280; --border:#E5E9F2;
  --accent:#0EA5E9; --danger:#EF4444; --chip:#F3F6FB; --chip-border:#E5EBF4;
  --radius:20px; --shadow:0 14px 36px rgba(17,24,39,.10);
}
[data-theme="dark"]{
  --bg:#0B1220; --card:#111827; --text:#E6EAF2; --muted:#9AA3B2; --border:#1E2637;
  --accent:#60C6F2; --danger:#F87171; --chip:#0F172A; --chip-border:#21304F;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}

/* ===== Overlay Sidebar (Drawer) + Backdrop ===== */
.layout{ display:block; min-height:100vh; }
.aside.drawer{
  position: fixed; inset: 0 auto 0 0; /* left drawer */
  width: 280px; max-width: 86vw;
  background:#111827; color:#cbd5e1;
  display:flex; flex-direction:column; gap:14px;
  padding:18px 16px;
  transform: translateX(-102%);
  transition: transform .28s ease;
  z-index: 1001;
  box-shadow: 8px 0 30px rgba(0,0,0,.24);
}
.aside.drawer .brand{display:flex;align-items:center;gap:10px}
.aside.drawer .brand .dot{width:12px;height:12px;border-radius:999px;background:var(--accent)}
.aside.drawer .brand .name{ color:#fff; font-weight:800 }
.aside.drawer .menu a{ display:flex; gap:10px; align-items:center; padding:10px 12px; border-radius:14px; color:#cbd5e1; text-decoration:none; font-weight:600 }
.aside.drawer .menu a.active,.aside.drawer .menu a:hover{ background:rgba(255,255,255,.08); color:#fff }
.aside.drawer .menu a .ico{ width:28px; height:28px; display:inline-grid; place-items:center; border-radius:10px; background:rgba(255,255,255,.06); color:#e2e8f0; font-size:15px }
.aside.drawer .menu a.active .ico{ background:rgba(255,255,255,.12); color:#fff }
.aside.drawer .footer-mini{margin-top:auto;font-size:12px;color:#94a3b8}

body.sb-open .aside.drawer{ transform: translateX(0); }
body.sb-open{ overflow:hidden; }

.backdrop{
  position: fixed; inset: 0;
  background: rgba(15,23,42,.45);
  backdrop-filter: blur(2px);
  opacity: 0; transition: opacity .25s ease;
  z-index: 1000;
}
body.sb-open .backdrop{ opacity:1; }
.backdrop[hidden]{ display:none; }
#sbToggle{ min-width:44px }

/* Topbar & main */
.topbar{position:sticky;top:0;z-index:9;background:transparent;backdrop-filter: blur(6px);margin-bottom:10px}
.container{max-width:1100px;margin:0 auto;padding:0 20px}
.topbar .wrap{display:flex;align-items:center;gap:10px;min-height:66px}
.credit-top{margin-left:auto;font-size:13px;color:var(--muted)}
.theme-btn,.btn{border:1px solid var(--border);background:var(--card);color:var(--text);padding:12px 14px;border-radius:14px;cursor:pointer;text-decoration:none;font-weight:700}
.btn.primary{background:var(--accent);color:#fff;border:0}
.btn-ghost{border:1px solid var(--border);background:var(--card);color:var(--text);padding:10px 12px;border-radius:12px;text-decoration:none;font-weight:700}
.btn{transition:transform .15s ease, box-shadow .15s ease} .btn:hover{transform:translateY(-1px)}
.btn, .btn-ghost, .theme-btn { position: relative; overflow: hidden; }
.ripple{position:absolute;transform:scale(0);border-radius:50%;background:rgba(255,255,255,.45);animation:ripple .6s linear;pointer-events:none}
@keyframes ripple{to{transform:scale(4);opacity:0}}

.main{padding:10px 0 24px}
.brandstrip{display:flex;gap:16px;align-items:center;flex-wrap:wrap;margin:6px 0 12px}
.brandstrip img{height:40px;object-fit:contain}

/* Cards & search */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
.section{padding:16px 16px}
.hero{padding:6px 0 6px}
.hero h1{font-size:clamp(26px,3.2vw,40px);margin:0 0 4px}
.sub{margin:0;color:var(--muted)}
.searchbar{margin:18px 0 6px;display:grid;grid-template-columns:1fr auto;gap:10px}
input[type="search"]{width:100%;padding:16px;border:1px solid var(--border);border-radius:16px;background:var(--card);outline:none}
input[type="search"]:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(14,165,233,.18)}
.options{color:var(--muted);display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.pill{background:var(--card);border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-size:12px}

/* Results */
.results{margin:16px 0 28px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px}
.carditem{background:var(--card);border:1px solid var(--border);border-radius:20px;overflow:hidden;box-shadow:var(--shadow);transition:transform .2s ease, box-shadow .2s ease}
.carditem:hover{transform:translateY(-4px);box-shadow:0 18px 44px rgba(17,24,39,.14)}
.imgwrap{background:var(--chip);height:180px;display:flex;align-items:center;justify-content:center}
.carditem img{max-height:100%;max-width:100%;object-fit:contain}
.body{padding:14px}
.name{font-weight:800;margin:0 0 6px;font-size:16px}
.brandtxt{color:var(--muted);font-size:13px;margin-bottom:10px}
.nutri{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px}
.chip{background:var(--chip);border:1px solid var(--chip-border);border-radius:12px;padding:10px 12px;font-size:13px;display:flex;justify-content:space-between;gap:8px}
.actions{display:flex;gap:8px;margin-top:12px}
.loader{display:none;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px;margin:18px 0}
.skeleton-card{height:220px;border-radius:20px;border:1px solid var(--border);background:linear-gradient(90deg,#eef2f7 25%, #f6f8fc 37%, #eef2f7 63%);background-size:400% 100%;animation:shimmer 1.2s infinite}
@keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}
.empty{color:var(--muted);text-align:center;margin:12px 0}

/* Footer & toast */
footer{border-top:1px solid var(--border);padding:18px 0 40px;color:var(--muted);font-size:13px}
.credit-bottom{margin-top:6px}
#toast{position:fixed;right:16px;bottom:16px;z-index:9999;display:none}
.toast{background:#111827;color:#fff;padding:10px 14px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.2);margin-top:8px;opacity:.98}

/* Motion preference */
@media (prefers-reduced-motion: reduce){
  *{ transition:none !important; animation:none !important; }
}
</style>
</head>
<body>
<div class="layout">

  <!-- ===== Sidebar (Overlay Drawer) ===== -->
  <aside class="aside drawer" id="sidebar" tabindex="-1" aria-hidden="true">
    <div class="brand"><span class="dot"></span> <span class="name">Nutrition Tools</span></div>
    <nav class="menu">
      <a class="active" href="index.html" title="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
        <span class="ico">üîé</span><span class="label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
      </a>
      <a href="calculator.html" title="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£">
        <span class="ico">üßÆ</span><span class="label">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£</span>
      </a>
    </nav>
    <div class="footer-mini">¬© 2025 SAKSIT.B @ Food & Nutrition@STVC ‚Ä¢ Better, Faster, Cheaper</div>
  </aside>

  <!-- Backdrop -->
  <div class="backdrop" id="sbBackdrop" hidden></div>

  <!-- ===== Main ===== -->
  <main class="main">
    <div id="toast"></div>

    <div class="topbar">
      <div class="container">
        <div class="wrap">
          <button class="btn" id="sbToggle" title="‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏°‡∏ô‡∏π (Ctrl+B)">‚ò∞</button>
          <div class="credit-top" id="creditTop"></div>
          <button class="theme-btn" id="themeToggle">‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°</button>
        </div>
      </div>
    </div>

    <div class="container">
      <!-- Logos -->
      <div class="brandstrip">
        <img id="logo1" alt="‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô 1" src="">
        <img id="logo2" alt="‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô 2" src="">
        <img id="logo3" alt="‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô 3" src="">
      </div>

      <!-- Hero + Search -->
      <div class="card section hero">
        <h1>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£</h1>
        <p class="sub">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å OpenFoodFacts ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå ¬∑ Static Web ‡∏ö‡∏ô GitHub Pages</p>

        <form class="searchbar" id="searchForm">
          <label class="sr" for="q" style="position:absolute;left:-10000px">‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
          <input id="q" type="search" placeholder="‡πÄ‡∏ä‡πà‡∏ô yogurt, rice, chocolate‚Ä¶" autocomplete="off" />
          <button class="btn primary" id="btnSearch" type="submit">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </form>

        <div class="options">
          <span class="pill">‡∏ú‡∏•/‡∏´‡∏ô‡πâ‡∏≤
            <select id="pageSize" style="background:transparent;border:0;color:inherit">
              <option>10</option><option selected>20</option><option>50</option>
            </select>
          </span>
          <span class="pill">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡πà‡∏≠ 100 g</span>
          <label class="pill" for="thOnly" title="‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢">
            <input id="thOnly" type="checkbox" style="margin-right:6px"> ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢
          </label>
          <a class="btn" href="calculator.html">üßÆ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î</a>
        </div>

        <div class="loader" id="loader" aria-hidden="true">
          <div class="skeleton-card"></div>
          <div class="skeleton-card"></div>
          <div class="skeleton-card"></div>
        </div>
        <div class="empty" id="empty"></div>
      </div>

      <!-- Results -->
      <section class="results" id="results" aria-live="polite"></section>
    </div>

    <footer>
      <div class="container">
        <div>‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: OpenFoodFacts (‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞) ¬∑ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô <em>per 100 g</em> ‡∏à‡∏≤‡∏Å‡∏â‡∏•‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï</div>
        <div class="credit-bottom" id="creditBottom"></div>
      </div>
    </footer>
  </main>
</div>

<script>
/* ===== Config ===== */
const API_SEARCH='https://world.openfoodfacts.org/cgi/search.pl';
const IMG_FALLBACK='https://static.openfoodfacts.org/images/icons/dist/product-add.svg';
const CREDIT_TEXT="‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥: ‡∏Ñ‡∏£‡∏π‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡∏ö‡∏≥‡∏£‡∏∏‡∏á | ‡πÅ‡∏ú‡∏ô‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢ | ¬© 2025";
const LOGOS=["assets/img/logo1.png","assets/img/logo2.png","assets/img/logo3.png"];

/* ===== Theme ===== */
const root=document.documentElement;
function applyTheme(t){ root.setAttribute('data-theme',t); localStorage.setItem('nf-theme',t);}
function toggleTheme(){const cur=localStorage.getItem('nf-theme')||'light';applyTheme(cur==='light'?'dark':'light');}
(function(){applyTheme(localStorage.getItem('nf-theme')||'light');})();
document.getElementById('themeToggle').addEventListener('click',toggleTheme);

/* ===== Ripple ===== */
function attachRipple(sel='.btn, .btn-ghost, .theme-btn'){document.querySelectorAll(sel).forEach(b=>{
  b.addEventListener('click',function(e){const r=document.createElement('span');const d=Math.max(this.clientWidth,this.clientHeight);
    r.className='ripple';r.style.width=r.style.height=d+'px';const rect=this.getBoundingClientRect();
    r.style.left=(e.clientX-rect.left-d/2)+'px';r.style.top=(e.clientY-rect.top-d/2)+'px';this.appendChild(r);setTimeout(()=>r.remove(),600);});});}

/* ===== Toast ===== */
function showToast(msg){const box=document.getElementById('toast');const el=document.createElement('div');el.className='toast';el.textContent=msg;box.appendChild(el);box.style.display='block';
  setTimeout(()=>{el.style.opacity='0';el.style.transform='translateY(6px)';},1600);
  setTimeout(()=>{el.remove();if(!box.children.length) box.style.display='none';},2100);}

/* ===== Logos + Credit ===== */
function safeSetLogo(id,src){const el=document.getElementById(id);if(!el) return; el.onerror=()=>{el.style.display='none'}; if(src) el.src=src;}
window.addEventListener('DOMContentLoaded',()=>{
  const [l1,l2,l3]=LOGOS; safeSetLogo('logo1',l1); safeSetLogo('logo2',l2); safeSetLogo('logo3',l3);
  document.getElementById('creditTop').textContent=CREDIT_TEXT; document.getElementById('creditBottom').textContent=CREDIT_TEXT;
  document.getElementById('q').focus(); attachRipple();
});

/* ===== Overlay Sidebar Control ===== */
(function overlaySidebar(){
  const body = document.body;
  const sidebar = document.getElementById('sidebar');
  const backdrop = document.getElementById('sbBackdrop');
  const toggleBtn = document.getElementById('sbToggle');
  const KEY = 'nf-sidebar-open';

  function openSB(){
    body.classList.add('sb-open');
    backdrop.hidden = false;
    sidebar.setAttribute('aria-hidden','false');
    toggleBtn?.setAttribute('aria-expanded','true');
    sidebar.focus({ preventScroll: true });
    try{ localStorage.setItem(KEY,'1'); }catch(e){}
  }
  function closeSB(){
    body.classList.remove('sb-open');
    sidebar.setAttribute('aria-hidden','true');
    toggleBtn?.setAttribute('aria-expanded','false');
    setTimeout(()=>{ backdrop.hidden = true; }, 200);
    try{ localStorage.setItem(KEY,'0'); }catch(e){}
  }
  function toggleSB(){ body.classList.contains('sb-open') ? closeSB() : openSB(); }

  try{ localStorage.getItem(KEY)==='1' ? openSB() : closeSB(); }catch(e){ closeSB(); }

  toggleBtn?.addEventListener('click', (e)=>{ e.stopPropagation(); toggleSB(); });
  backdrop?.addEventListener('click', closeSB);
  document.addEventListener('click', (e)=>{
    if(!body.classList.contains('sb-open')) return;
    const t=e.target; if(sidebar.contains(t) || toggleBtn?.contains(t)) return;
    closeSB();
  }, true);
  window.addEventListener('keydown', (e)=>{
    if(e.key==='Escape' && body.classList.contains('sb-open')){ e.preventDefault(); closeSB(); }
    if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='b'){ e.preventDefault(); toggleSB(); }
  });
  window.addEventListener('resize', ()=>{ if(body.classList.contains('sb-open')) closeSB(); });
})();

/* ===== Utils ===== */
const $=s=>document.querySelector(s);
function fmt(n,d=1){if(n==null||Number.isNaN(n)) return '‚Äì'; return Number(n).toFixed(d);}
function chip(lbl,val,unit=''){return `<div class="chip"><span>${lbl}</span><strong>${val} ${unit}</strong></div>`;}
function buildNutritionText(p){const N=p.nutriments||{};const name=p.product_name_th||p.generic_name_th||p.product_name||p.generic_name||'-';const brand=p.brands||'-';
  const energy=N['energy-kcal_100g'] ?? (N['energy_100g']? N['energy_100g']/4.184:undefined);
  const protein=N['proteins_100g'], fat=N['fat_100g'], carbs=N['carbohydrates_100g'], sugars=N['sugars_100g'], fiber=N['fiber_100g'], sodium=N['sodium_100g'], salt=N['salt_100g'];
  return `‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå: ${name}\n‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠: ${brand}\n‡∏ï‡πà‡∏≠ 100 g:\n- ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô: ${fmt(energy)} kcal\n- ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô: ${fmt(protein)} g\n- ‡πÑ‡∏Ç‡∏°‡∏±‡∏ô: ${fmt(fat)} g\n- ‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏Ø: ${fmt(carbs)} g\n- ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•: ${fmt(sugars)} g\n- ‡πÉ‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£: ${fmt(fiber)} g\n- ‡πÇ‡∏ã‡πÄ‡∏î‡∏µ‡∏¢‡∏°: ${sodium!=null?fmt(sodium*1000):'‚Äì'} mg\n- ‡πÄ‡∏Å‡∏•‡∏∑‡∏≠: ${fmt(salt)} g\n‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: OpenFoodFacts`; }
async function copyNutritionFromIndex(i){const p=window.__products?.[i]; if(!p) return; try{await navigator.clipboard.writeText(buildNutritionText(p)); showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß');}catch(e){console.error(e)}}

/* ===== Card Renderer ===== */
function renderCard(p,i){const n=p.product_name_th||p.generic_name_th||p.product_name||p.generic_name||'(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå)';
  const brand=p.brands||'‚Äî'; const img=p.image_front_small_url||p.image_url||IMG_FALLBACK; const N=p.nutriments||{};
  const energy=N['energy-kcal_100g'] ?? (N['energy_100g']? N['energy_100g']/4.184:undefined);
  const protein=N['proteins_100g'], fat=N['fat_100g'], carbs=N['carbohydrates_100g'], sugars=N['sugars_100g'], fiber=N['fiber_100g']; const sodium=N['sodium_100g'], salt=N['salt_100g'];
  const code=p.code||''; const url=code?`https://world.openfoodfacts.org/product/${code}`:(p.url||'#');
  return `<article class="carditem">
    <div class="imgwrap"><img alt="${n}" loading="lazy" src="${img}"></div>
    <div class="body">
      <h3 class="name">${n}</h3>
      <div class="brandtxt">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï: ${brand}</div>
      <div class="nutri">
        ${chip('‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô',fmt(energy),'kcal')}
        ${chip('‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô',fmt(protein),'g')}
        ${chip('‡πÑ‡∏Ç‡∏°‡∏±‡∏ô',fmt(fat),'g')}
        ${chip('‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏Ø',fmt(carbs),'g')}
        ${chip('‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•',fmt(sugars),'g')}
        ${chip('‡πÉ‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£',fmt(fiber),'g')}
        ${chip('‡πÇ‡∏ã‡πÄ‡∏î‡∏µ‡∏¢‡∏°',sodium!=null?fmt(sodium*1000):'‚Äì','mg')}
        ${chip('‡πÄ‡∏Å‡∏•‡∏∑‡∏≠',fmt(salt),'g')}
      </div>
      <div class="actions">
        <button class="btn" onclick="copyNutritionFromIndex(${i})">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        <a class="btn-ghost" href="${url}" target="_blank" rel="noopener">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
      </div>
    </div>
  </article>`; }

/* ===== Search ===== */
async function searchFoods(q,pageSize=20){
  const url=new URL(API_SEARCH); url.searchParams.set('search_terms',q); url.searchParams.set('search_simple','1');
  url.searchParams.set('action','process'); url.searchParams.set('json','1'); url.searchParams.set('page_size',String(pageSize)); url.searchParams.set('lc','th');
  if(document.getElementById('thOnly').checked){
    url.searchParams.set('tagtype_0','countries'); url.searchParams.set('tag_contains_0','contains'); url.searchParams.set('tag_0','Thailand');
    url.searchParams.set('tagtype_1','purchase_places'); url.searchParams.set('tag_contains_1','contains'); url.searchParams.set('tag_1','Thailand');
  }
  $('#loader').style.display='grid'; $('#empty').textContent=''; $('#results').innerHTML='';
  try{
    const res=await fetch(url.toString()); if(!res.ok) throw new Error('Network');
    const data=await res.json(); const products=(data.products||[]).filter(p=>p.nutriments);
    window.__products=products;
    if(!products.length){ $('#empty').textContent='‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏•‡∏≠‡∏á‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏≤‡∏ï‡∏¥‡πä‡∏Å "‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢" ‡∏≠‡∏≠‡∏Å'; return; }
    $('#results').innerHTML=products.map((p,i)=>renderCard(p,i)).join(''); attachRipple();
  }catch(e){ console.error(e); $('#empty').textContent='‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'; }
  finally{ $('#loader').style.display='none'; }
}
document.getElementById('searchForm').addEventListener('submit',e=>{
  e.preventDefault(); const q=$('#q').value.trim(); if(!q){ $('#empty').textContent='‡πÇ‡∏õ‡∏£‡∏î‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'; return; }
  const page=Number($('#pageSize').value||20); searchFoods(q,page);
});
</script>
</body>
</html>
