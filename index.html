<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nutrition Finder | ค้นหาคุณค่าโภชนาการอาหาร</title>
  <meta name="description" content="ค้นหาโภชนาการจาก OpenFoodFacts บน GitHub Pages (Static Web App)" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* ===== Theme: Light, modern, accessible ===== */
    :root{
      --bg:#f7fafc;         /* พื้นหลังอ่อน */
      --text:#0f172a;       /* ตัวอักษรเข้ม */
      --muted:#5b677a;      /* อธิบาย/รอง */
      --card:#ffffff;       /* การ์ด */
      --border:#e5e9f2;     /* เส้นคั่น */
      --accent:#2563eb;     /* ฟ้าเข้ม */
      --accent-weak:#e6efff;/* ฟ้าอ่อน */
      --chip:#f1f5f9;       /* พื้นชิป */
      --chip-border:#e2e8f0;/* เส้นชิป */
      --radius:16px;
      --shadow:0 5px 18px rgba(15,23,42,.06);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}

    /* Header */
    .topbar{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.8);backdrop-filter: blur(10px);border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    .topbar .wrap{display:flex;align-items:center;gap:14px;min-height:64px}
    .logo{display:inline-flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
    .logo .dot{width:12px;height:12px;border-radius:999px;background:var(--accent)}
    .title{font-weight:800;font-size:18px;letter-spacing:.2px}
    .credit-top{margin-left:auto;font-size:13px;color:var(--muted)}

    /* Hero / Intro */
    header.hero{padding:24px 0 10px}
    header.hero h1{font-size:clamp(24px,3.2vw,38px);margin:6px 0 8px}
    header.hero .sub{margin:0;color:var(--muted)}

    /* Search */
    .searchbar{margin:18px 0 6px;display:grid;grid-template-columns:1fr auto;gap:10px}
    input[type="search"]{width:100%;padding:16px 16px;border-radius:var(--radius);border:1px solid var(--border);background:#fff;color:var(--text);outline:none;box-shadow:var(--shadow)}
    input[type="search"]:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-weak)}
    button{border:0;background:var(--accent);color:#fff;padding:14px 18px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    button:hover{filter:brightness(.95)}

    /* Options */
    .options{color:var(--muted);display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{background:#fff;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;box-shadow:var(--shadow)}

    /* Results */
    .results{margin:18px 0 60px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--shadow)}
    .card .imgwrap{background:#f8fafc;height:170px;display:flex;align-items:center;justify-content:center}
    .card img{max-height:100%;max-width:100%;object-fit:contain}
    .card .body{padding:14px 14px 8px}
    .name{font-weight:700;margin:0 0 6px;font-size:16px}
    .brand{color:var(--muted);font-size:13px;margin-bottom:10px}
    .nutri{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px}
    .chip{background:var(--chip);border:1px solid var(--chip-border);border-radius:12px;padding:10px 12px;font-size:13px;display:flex;justify-content:space-between;gap:8px}
    .muted{color:var(--muted)}

    .loader{display:none;place-items:center;margin:24px auto;color:var(--muted)}
    .empty{color:var(--muted);text-align:center;margin:26px 0}

    /* Footer */
    footer{border-top:1px solid var(--border);padding:18px 0 40px;color:var(--muted);font-size:13px}
    .credit-bottom{margin-top:6px}

    a{color:#0b5ad9}
    .sr{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <!-- ===== Topbar (ตำแหน่งใส่เครดิตบนสุด) ===== -->
  <div class="topbar">
    <div class="container">
      <div class="wrap">
        <a class="logo" href="#" aria-label="Home">
          <span class="dot"></span>
          <span class="title">Nutrition Finder</span>
        </a>
        <div class="credit-top" id="creditTop"><!-- ใส่เครดิตบนสุดที่นี่ด้วยสคริปต์ หรือลบ id แล้วพิมพ์เองก็ได้ --></div>
      </div>
    </div>
  </div>

  <!-- ===== Hero ===== -->
  <div class="container">
    <header class="hero" role="banner">
      <h1>ค้นหาคุณค่าโภชนาการอาหาร</h1>
      <p class="sub">ดึงข้อมูลจากฐานสาธารณะ OpenFoodFacts แบบเรียลไทม์ ? เว็บสแตติกบน GitHub Pages ? เหมาะกับงานสอน/สืบค้น</p>

      <form class="searchbar" id="searchForm">
        <label class="sr" for="q">คำค้นหา</label>
        <input id="q" type="search" placeholder="พิมพ์ชื่ออาหาร/ผลิตภัณฑ์ เช่น yogurt, rice, chocolate" autocomplete="off" />
        <button id="btnSearch" type="submit">ค้นหา</button>
      </form>

      <div class="options">
        <span class="pill" title="จำนวนผลลัพธ์ต่อหน้า">ผล/หน้า
          <select id="pageSize" style="background:transparent;border:0;color:inherit">
            <option>10</option>
            <option selected>20</option>
            <option>50</option>
          </select>
        </span>
        <span class="pill">หน่วยต่อ 100 g (ตามฉลาก)</span>
      </div>

      <div class="loader" id="loader">กำลังค้นหา</div>
      <div class="empty" id="empty"></div>
    </header>

    <!-- ===== Results ===== -->
    <section class="results" id="results" aria-live="polite"></section>
  </div>

  <!-- ===== Footer (ตำแหน่งใส่เครดิตล่างสุด) ===== -->
  <footer>
    <div class="container">
      <div>แหล่งข้อมูล: OpenFoodFacts (สาธารณะ). ค่าที่แสดงเป็น <em>per 100 g</em> จากฉลากผู้ผลิต อาจไม่ครบทุกสารอาหาร</div>
      <div class="credit-bottom" id="creditBottom"><!-- ใส่เครดิตล่างสุดที่นี่ด้วยสคริปต์ หรือลบ id แล้วพิมพ์เองก็ได้ --></div>
    </div>
  </footer>

<script>
// ===== Config =====
const API_SEARCH = 'https://world.openfoodfacts.org/cgi/search.pl';
const IMG_FALLBACK = 'https://static.openfoodfacts.org/images/icons/dist/product-add.svg';

/* ===== ใส่เครดิตของคุณที่นี่ (แก้บรรทัดนี้) =====
   ตัวอย่าง: "ผู้จัดทำ: ครูศักดิ์สิทธิ์ บำรุง | วิทยาลัยอาชีวศึกษา | ? 2025"
*/
const CREDIT_TEXT = "ผู้จัดทำ: ครูศักดิ์สิทธิ์  บำรุง | แผนกวิชาอาหารและโภชนาการ วิทยาลัยอาชีวศึกษาสุโขทัย | ? 2025"; // ?? แก้บรรทัดนี้

// แสดงเครดิตที่ด้านบนและด้านล่าง (จะไปแทนที่ <div id="creditTop"> และ <div id="creditBottom"> )
window.addEventListener('DOMContentLoaded',()=>{
  const top = document.getElementById('creditTop');
  const bottom = document.getElementById('creditBottom');
  if(top) top.textContent = CREDIT_TEXT;
  if(bottom) bottom.textContent = CREDIT_TEXT;
  document.getElementById('q').focus();
});

// ===== Helpers =====
const $ = (sel)=>document.querySelector(sel);
function fmt(num, digits=1){
  if(num===undefined || num===null || Number.isNaN(num)) return '';
  return Number(num).toFixed(digits);
}
function makeChip(label, value, unit=''){
  return `<div class="chip"><span>${label}</span><strong>${value} ${unit}</strong></div>`;
}

// ===== Render Card =====
function renderCard(p){
  const n = p.product_name || p.generic_name || '(ไม่มีชื่อผลิตภัณฑ์)';
  const brand = p.brands || '';
  const img = p.image_front_small_url || p.image_url || IMG_FALLBACK;
  const N = p.nutriments || {};
  const energy = N['energy-kcal_100g'] ?? (N['energy_100g']? N['energy_100g']/4.184 : undefined); // kcal fallback
  const protein = N['proteins_100g'];
  const fat = N['fat_100g'];
  const carbs = N['carbohydrates_100g'];
  const sugars = N['sugars_100g'];
  const fiber = N['fiber_100g'];
  const sodium = N['sodium_100g'];
  const salt = N['salt_100g'];

  return `
  <article class="card">
    <div class="imgwrap"><img alt="${n}" loading="lazy" src="${img}"></div>
    <div class="body">
      <h3 class="name">${n}</h3>
      <div class="brand">ยี่ห้อ/ผู้ผลิต: ${brand}</div>
      <div class="nutri">
        ${makeChip('พลังงาน', fmt(energy), 'kcal')}
        ${makeChip('โปรตีน', fmt(protein), 'g')}
        ${makeChip('ไขมัน', fmt(fat), 'g')}
        ${makeChip('คาร์บฯ', fmt(carbs), 'g')}
        ${makeChip('น้ำตาล', fmt(sugars), 'g')}
        ${makeChip('ใยอาหาร', fmt(fiber), 'g')}
        ${makeChip('โซเดียม', sodium!=null?fmt(sodium*1000):'', 'mg')}
        ${makeChip('เกลือ', fmt(salt), 'g')}
      </div>
      <div class="muted" style="margin-top:10px">
        รหัสบาร์โค้ด: ${p.code || ''} ? ประเทศ: ${p.countries || ''}
      </div>
    </div>
  </article>`;
}

// ===== Search =====
async function searchFoods(q, pageSize=20){
  const url = new URL(API_SEARCH);
  url.searchParams.set('search_terms', q);
  url.searchParams.set('search_simple', '1');
  url.searchParams.set('action', 'process');
  url.searchParams.set('json', '1');
  url.searchParams.set('page_size', String(pageSize));

  $('#loader').style.display='grid';
  $('#empty').textContent='';
  $('#results').innerHTML='';

  try{
    const res = await fetch(url.toString());
    if(!res.ok) throw new Error('Network error');
    const data = await res.json();
    const products = (data.products||[]).filter(p=>p.nutriments);

    if(products.length===0){
      $('#empty').textContent='ไม่พบข้อมูล ลองใช้คำค้นอื่น (เช่น ภาษาอังกฤษ/ทั่วไป)';
      return;
    }
    const html = products.map(renderCard).join('');
    $('#results').innerHTML = html;
  }catch(err){
    console.error(err);
    $('#empty').textContent='เกิดข้อผิดพลาดในการดึงข้อมูล กรุณาลองใหม่อีกครั้ง';
  }finally{
    $('#loader').style.display='none';
  }
}

// ===== Events =====
const form = $('#searchForm');
form.addEventListener('submit', (e)=>{
  e.preventDefault();
  const q = $('#q').value.trim();
  if(!q){
    $('#empty').textContent='โปรดพิมพ์คำค้นหา';
    return;
  }
  const pageSize = Number($('#pageSize').value || 20);
  searchFoods(q, pageSize);
});
</script>
</body>
</html>